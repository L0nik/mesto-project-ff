(()=>{var e={49:e=>{var t={host:"https://nomoreparties.co",apiVersion:"v1",cohortId:"",token:""};function n(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={method:e,headers:{authorization:t.token,"Content-Type":"application/json"}};return 0!==Object.keys(o).length&&(r.body=JSON.stringify(o)),fetch("".concat(t.host,"/").concat(t.apiVersion,"/").concat(t.cohortId,"/").concat(n),r)}e.exports={apiConfigInit:function(e,n){t.cohortId=e,t.token=n},getUserData:function(){return n("GET","users/me")},getCards:function(){return n("GET","cards")},patchUserData:function(e){return n("PATCH","users/me",e)},cardAdd:function(e){return n("POST","cards",e)},cardDelete:function(e){return n("DELETE","cards/".concat(e))},cardPutLike:function(e){return n("PUT","cards/likes/".concat(e))},cardDeleteLike:function(e){return n("DELETE","cards/likes/".concat(e))},changeAvatar:function(e){return n("PATCH","users/me/avatar",e)}}},694:e=>{var t=document.querySelector("#card-template").content;e.exports={createCardElement:function(e,n,o){var r=e.owner._id===n,a=t.cloneNode(!0),c=a.querySelector(".card__title"),i=a.querySelector(".card__image"),u=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__number-of-likes");return c.textContent=e.name,i.src=e.link,i.alt="".concat(e.name," (фото)"),s.textContent=e.likes.length,e.likes.reduce((function(e,t){return t._id===n||e}),!1)&&l.classList.add("card__like-button_is-active"),r?u.addEventListener("click",(function(t){return o.eventHandlers.deleteCardElement(t,e._id,o)})):u.style.display="none",l.addEventListener("click",(function(t){o.eventHandlers.likeButtonHandler(e._id,l,s,o)})),i.addEventListener("click",(function(t){return o.eventHandlers.imageClickEventHandler(e)})),a},deleteCardElement:function(e,t,n){var o=e.target.closest(".places__item"),r=document.querySelector(".popup_type_remove-card");document.forms["remove-card"].addEventListener("submit",(function(e){(function(e,t,n,o){return e.preventDefault(),new Promise((function(e,r){o.apiMethods.cardDelete(n).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(n){t.remove(),e("success")})).catch((function(e){console.error(e),r(e)}))}))})(e,o,t,n).then((function(e){return n.popupMethods.closePopup(r)})).catch((function(e){return console.log(e)}))})),n.popupMethods.openPopup(r)},likeButtonHandler:function(e,t,n,o){t.classList.toggle("card__like-button_is-active");var r=t.classList.contains("card__like-button_is-active")?"cardPutLike":"cardDeleteLike";o.apiMethods[r](e).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){n.textContent=e.likes.length})).catch((function(e){return console.error(e)}))}}},632:e=>{function t(e){e.classList.remove("popup_is-opened"),e.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(e.target.closest(".popup"))}e.exports={openPopup:function(e){e.classList.add("popup_is-opened"),e.addEventListener("keydown",n),e.querySelector(".popup__close").focus(),e.focus()},closePopup:t,changeSubmitButtonState:function(e,t){var n=e.querySelector('[type="submit"]');if(void 0!==n){var o="content"+t;n.textContent=n.dataset[o]}}}},314:e=>{function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function n(e,t,n){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.patternMismatchError):e.setCustomValidity("")}(t),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_error"),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_error"),o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}e.exports={enableValidation:function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(o){return function(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r.forEach((function(c){c.addEventListener("input",(function(){n(e,c,o),t(r,a,o)}))}))}(o,e)}))},clearValidation:function(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector));t(r,e.querySelector(o.submitButtonSelector),o),r.forEach((function(t){return n(e,t,o)}))}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(694),t=n(632),o=n(314),r=n(49);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var c,i=document.querySelector(".places__list"),u=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__image"),p=document.querySelectorAll(".popup"),d=document.querySelector(".popup_type_change-avatar"),f=document.forms["change-avatar"],m=document.querySelector(".popup_type_edit"),v=m.querySelector(".popup__input_type_name"),_=m.querySelector(".popup__input_type_description"),y=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),S=document.querySelector(".popup_type_new-card"),g=document.forms["new-place"],b=g.elements["place-name"],k=g.elements.link,E=document.querySelector(".popup_type_image"),L=E.querySelector(".popup__image"),C=E.querySelector(".popup__caption"),q={eventHandlers:{deleteCardElement:e.deleteCardElement,likeButtonHandler:e.likeButtonHandler,imageClickEventHandler:function(e){C.textContent=e.name,L.src=e.link,L.alt="".concat(e.name," (фото)"),(0,t.openPopup)(E)}},apiMethods:{cardDelete:r.cardDelete,cardPutLike:r.cardPutLike,cardDeleteLike:r.cardDeleteLike},popupMethods:{openPopup:t.openPopup,closePopup:t.closePopup}},P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__error",errorClass:"popup__error_visible"};function x(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"prepend",r=(0,e.createCardElement)(t,c,n);i[o](r)}function A(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")")}u.addEventListener("click",(function(e){v.value=y.textContent,_.value=h.textContent,(0,o.clearValidation)(document.forms["edit-profile"],P),(0,t.openPopup)(m)})),l.addEventListener("click",(function(e){(0,t.openPopup)(S),(0,o.clearValidation)(g,P)})),s.addEventListener("click",(function(e){(0,t.openPopup)(d),(0,o.clearValidation)(f,P)})),d.addEventListener("submit",(function(e){e.preventDefault(),(0,t.changeSubmitButtonState)(d,"Loading");var n={avatar:f.link.value};(0,r.changeAvatar)(n).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){A(e),f.reset(),(0,o.clearValidation)(f,P),(0,t.closePopup)(d)})).catch((function(e){return console.error(e)})).finally((function(){return(0,t.changeSubmitButtonState)(d,"Normal")}))})),m.addEventListener("submit",(function(e){e.preventDefault(),(0,t.changeSubmitButtonState)(m,"Loading"),(0,r.patchUserData)({name:v.value,about:_.value}).then((function(e){if(e.ok)return e.json();console.error("Failed to patch user data")})).then((function(e){y.textContent=e.name,h.textContent=e.about,(0,t.closePopup)(m)})).catch((function(e){return console.log(e)})).finally((function(){return(0,t.changeSubmitButtonState)(m,"Normal")}))})),S.addEventListener("submit",(function(e){e.preventDefault(),(0,t.changeSubmitButtonState)(S,"Loading");var n={name:b.value,link:k.value};(0,r.cardAdd)(n).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){x(e,q),g.reset(),(0,o.clearValidation)(g,P),(0,t.closePopup)(S)})).catch((function(e){return console.error(e)})).finally((function(){return(0,t.changeSubmitButtonState)(S,"Normal")}))})),p.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_is-opened")&&(0,t.closePopup)(e),n.target.classList.contains("popup__close")&&(0,t.closePopup)(e)}))})),(0,o.enableValidation)(P),(0,r.apiConfigInit)("wff-cohort-31","704e92ea-c623-4f71-b219-923161e177d0");var D=(0,r.getUserData)(),j=(0,r.getCards)();Promise.all([D,j]).then((function(e){e[0].json().then((function(e){c=e._id,A(e)})),e[1].json().then((function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,c=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw c}}}}(e);try{for(n.s();!(t=n.n()).done;)x(t.value,q,"append")}catch(e){n.e(e)}finally{n.f()}}))})).catch((function(e){return console.log(e)}))})()})();